<div>
  <div class="my-4">
    <h2 class="text-2xl text-start font-bold">Anexar Carteira de Estudante</h2>
    <p class="text-black text-start text-sm mt-1">
      Caso seja estudante, anexe sua carteirinha.
    </p>
  </div>

  <div class="bg-white rounded-xl shadow-lg p-6 h-auto flex flex-col justify-center items-center gap-4">

    <!-- If document already sent -->
    <div *ngIf="cardUploaded" class="text-center">
      <p class="text-green-600 font-medium text-sm">Carteirinha já enviada!</p>
    </div>

    <!-- Upload Area -->
    <ng-container *ngIf="!cardUploaded && !imagePreview">
      <div
        class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed rounded-lg border-gray-400 bg-gray-50 opacity-50 cursor-pointer"
        (click)="fileInput.click()"
      >
        <img src="exit.png" alt="Upload Icon" class="w-9 h-9 mb-2"/>

        <span class="text-gray-600 text-sm font-medium text-center" *ngIf="isViewMode">
          Usuário administrador — envio de carteirinha desabilitada.
        </span>
        
        <span class="text-gray-600 text-sm font-medium text-center p-5" *ngIf="!isViewMode">
          Clique para selecionar o arquivo da carteirinha aqui
        </span>

        <input
          #fileInput
          type="file"
          accept="image/*,.pdf"
          class="hidden disabled:bg-gray-200 disabled:text-gray-500"
          [disabled]="isViewMode"
          (change)="onCardSelected($event)"
        />
      </div>
    </ng-container>

    <!-- Preview 
    <div *ngIf="previewUrlCard && !cardUploaded" class="mt-4 w-full flex flex-col items-center">
      <ng-container *ngIf="!isPdf; else pdfPreview">
        <img [src]="previewUrlCard" alt="Preview" class="max-h-40 rounded-lg border border-gray-300"/>
      </ng-container>
      <ng-template #pdfPreview>
        <div class="flex flex-col items-center">
          <svg class="w-12 h-12 text-red-500" fill="currentColor" viewBox="0 0 20 20">
            <path d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7l-5-5H6z"/>
          </svg>
          <p class="text-sm text-gray-600 mt-1">Arquivo PDF selecionado</p>
        </div>
      </ng-template>

      <p class="text-xs text-gray-500 mt-2">Pré-visualização da carteirinha</p>

      <app-button
        *ngIf="cardToUpload"
        type="button"
        (click)="sendImage()"
        class="mt-4 w-full"
      >
        Enviar Carteirinha
      </app-button>

      <button class="w-full bg-yellow-400 text-white text-sm mt-2 py-2 px-4 rounded-lg font-semibold cursor-pointer hover:bg-yellow-500 transition"
        type="button" (click)="resetUpload()">
        Enviar outra Carteirinha
      </button>
    </div>
-->


     <!-- Preview -->
    <div *ngIf="imagePreview && !cardUploaded" class="mt-4 w-full flex flex-col items-center">
    
      <ng-container *ngIf="!isPdf">
          <img [src]="imagePreview" alt="Pré-visualização do Documento" class="flex flex-col items-center justify-center max-h-40 w-full rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-4"/>
      </ng-container>

      <ng-container *ngIf="isPdf">
          <div class="flex flex-col items-center justify-center h-40 w-full rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-4">
            <svg class="w-10 h-10 text-red-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112.586 2.414L16 5.828A2 2 0 0116 7.242V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 10a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1-5a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path>
            </svg>
            <p class="text-gray-700 text-sm font-medium mt-2 text-center break-words">
                Arquivo PDF selecionado: <br>**{{ cardToUpload?.name }}**
            </p>
          </div>
      </ng-container>

      <p class="text-xs text-gray-500 mt-2">Pré-visualização do documento</p>

      <app-button
          *ngIf="cardToUpload"
          type="button"
          (click)="sendImage()"
          class="mt-4 w-full"
      >
          Enviar Carteirinha
      </app-button>

      <button class="w-full bg-yellow-400 text-white text-sm mt-2 py-2 px-4 rounded-lg font-semibold cursor-pointer hover:bg-yellow-500 transition"
          type="button" (click)="resetUpload()">
          Enviar outra Carteirinha
      </button>
    </div>
  </div>
</div>
